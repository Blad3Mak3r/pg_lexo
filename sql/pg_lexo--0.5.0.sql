-- pg_lexo 0.5.0 migration SQL
-- This migration adds the new LexoRank custom type and related functions
-- while maintaining backwards compatibility with TEXT-based functions.

-- Note: The actual type and function definitions are auto-generated by pgrx.
-- This file documents the migration path and provides manual upgrade steps
-- if needed.

-- ============================================================================
-- NEW IN 0.5.0: LexoRank Custom Type
-- ============================================================================
-- The extension now provides a custom `LexoRank` PostgreSQL type instead of
-- using TEXT. This type has proper comparison operators and can be used
-- directly in ORDER BY clauses without COLLATE "C".
--
-- New type: lexorank
-- With operators: =, <>, <, <=, >, >=
-- With btree and hash operator classes for indexing
--
-- ============================================================================
-- BACKWARDS COMPATIBILITY
-- ============================================================================
-- The following TEXT-based functions are provided for backwards compatibility:
--   - lexo.first_text() -> TEXT
--   - lexo.after_text(TEXT) -> TEXT
--   - lexo.before_text(TEXT) -> TEXT
--   - lexo.between_text(TEXT, TEXT) -> TEXT
--
-- The main functions now use the LexoRank type:
--   - lexo.first() -> lexorank
--   - lexo.after(lexorank) -> lexorank
--   - lexo.before(lexorank) -> lexorank
--   - lexo.between(lexorank, lexorank) -> lexorank
--   - lexo.next(text, text, text, text) -> lexorank
--   - lexo.add_lexo_column_to(text, text) -- Now creates lexorank columns
--   - lexo.rebalance(text, text, text, text) -> bigint
--
-- ============================================================================
-- MIGRATION GUIDE
-- ============================================================================
-- To migrate existing TEXT columns to LexoRank:
--
-- 1. Add a new LexoRank column:
--    ALTER TABLE your_table ADD COLUMN position_new lexorank;
--
-- 2. Copy data (LexoRank accepts the same Base62 strings):
--    UPDATE your_table SET position_new = position::lexorank;
--
-- 3. Drop the old column and rename:
--    ALTER TABLE your_table DROP COLUMN position;
--    ALTER TABLE your_table RENAME COLUMN position_new TO position;
--
-- Alternatively, keep using TEXT columns with the _text variants of functions.
--
-- ============================================================================
-- EXAMPLE USAGE
-- ============================================================================
-- Using the new LexoRank type:
--
-- CREATE TABLE items (
--     id SERIAL PRIMARY KEY,
--     position lexorank NOT NULL
-- );
--
-- INSERT INTO items (position) VALUES (lexo.first());
-- INSERT INTO items (position) VALUES (lexo.after(lexo.first()));
--
-- SELECT * FROM items ORDER BY position;  -- No COLLATE needed!
--
-- ============================================================================
